<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border-left: 5px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 5px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 5px solid #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-left: 5px solid #ffc107; }
        button { padding: 12px 20px; margin: 8px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        button:disabled { background: #6c757d; cursor: not-allowed; transform: none; }
        .setup-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; margin-bottom: 15px; }
        .setup-card h3 { margin-top: 0; color: #495057; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 15px 0; border: 1px solid #dee2e6; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë„êµ¬</h1>
        
        <div id="mainStatus" class="status info">
            <div class="spinner"></div>
            ì„¤ì • ë„êµ¬ ì´ˆê¸°í™” ì¤‘...
        </div>
        
        <div class="setup-card">
            <h3>1ï¸âƒ£ ê¸°ë³¸ í…Œì´ë¸” ìƒì„±</h3>
            <p>ê¸°ë³¸ì ì¸ í…Œì´ë¸” êµ¬ì¡°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
            <button id="createTablesBtn" onclick="createTables()">í…Œì´ë¸” ìƒì„±</button>
            <div id="createTablesResult"></div>
        </div>
        
        <div class="setup-card">
            <h3>2ï¸âƒ£ ì´ˆê¸° ë°ì´í„° ì„¤ì •</h3>
            <p>í•„ìˆ˜ ì½”ë“œ ë°ì´í„°ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤ (ë§¤ë¬¼ ìœ í˜•, ê±°ë˜ ìœ í˜• ë“±).</p>
            <button id="setupInitialDataBtn" onclick="setupInitialData()">ì´ˆê¸° ë°ì´í„° ì„¤ì •</button>
            <div id="setupInitialDataResult"></div>
        </div>
        
        <div class="setup-card">
            <h3>3ï¸âƒ£ ìŠ¤í‚¤ë§ˆ ìˆ˜ì •</h3>
            <p>í•„ìš”í•œ ì»¬ëŸ¼ì„ ì¶”ê°€í•˜ê³  ì œì•½ ì¡°ê±´ì„ ì™„í™”í•©ë‹ˆë‹¤.</p>
            <button id="modifySchemaBtn" onclick="modifySchema()">ìŠ¤í‚¤ë§ˆ ìˆ˜ì •</button>
            <div id="modifySchemaResult"></div>
        </div>
        
        <div class="setup-card">
            <h3>4ï¸âƒ£ ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
            <p>ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œëœ í›„ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
            <button id="testConnectionBtn" onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div id="testConnectionResult"></div>
        </div>
        
        <div>
            <h3>ğŸ“‹ ì‹¤í–‰ ë¡œê·¸</h3>
            <div id="logContainer" class="log">ì‹¤í–‰ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...\n</div>
            <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2';

        const supabaseUrl = 'https://qwxghpwasmvottahchky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3eGdocHdhc212b3R0YWhjaGt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTI3NTksImV4cCI6MjA2ODQ4ODc1OX0.4a1Oc66k9mGmXLoHmrKyZiVeZISpyzgq1BERrb_-8n8';
        
        const supabase = createClient(supabaseUrl, supabaseKey, {
            auth: { persistSession: false },
            global: {
                headers: {
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Headers': '*',
                }
            }
        });

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logContainer');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ”';
            logElement.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`${prefix} ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('mainStatus');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }

        function updateResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}" style="margin-top: 10px; font-size: 14px;">${content}</div>`;
        }

        async function createTables() {
            const createTablesBtn = document.getElementById('createTablesBtn');
            createTablesBtn.disabled = true;
            
            try {
                log('ğŸ”„ í…Œì´ë¸” ìƒì„± ì‹œì‘...');
                updateResult('createTablesResult', 'í…Œì´ë¸” ìƒì„± ì¤‘...', 'info');
                
                // uuid-ossp í™•ì¥ ëª¨ë“ˆ í™œì„±í™”
                const { error: extError } = await supabase.rpc('extensions', {
                    name: 'uuid-ossp'
                });
                
                if (extError) {
                    log(`âš ï¸ uuid-ossp í™•ì¥ ëª¨ë“ˆ í™œì„±í™” ì‹¤íŒ¨ (ë¬´ì‹œ ê°€ëŠ¥): ${extError.message}`, 'warning');
                } else {
                    log('âœ… uuid-ossp í™•ì¥ ëª¨ë“ˆ í™œì„±í™” ì„±ê³µ', 'success');
                }
                
                // ê¸°ë³¸ í…Œì´ë¸” ìƒì„±
                const tables = [
                    {
                        name: 'users',
                        query: `CREATE TABLE IF NOT EXISTS public.users (
                            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                            google_id TEXT UNIQUE,
                            email TEXT UNIQUE NOT NULL,
                            name TEXT,
                            avatar_url TEXT,
                            phone TEXT,
                            role TEXT DEFAULT 'user',
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                            last_login TIMESTAMP WITH TIME ZONE,
                            status TEXT DEFAULT 'active'
                        );`
                    },
                    {
                        name: 'property_types',
                        query: `CREATE TABLE IF NOT EXISTS public.property_types (
                            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                            name TEXT UNIQUE NOT NULL,
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
                        );`
                    },
                    {
                        name: 'property_statuses',
                        query: `CREATE TABLE IF NOT EXISTS public.property_statuses (
                            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                            name TEXT UNIQUE NOT NULL,
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
                        );`
                    },
                    {
                        name: 'transaction_types',
                        query: `CREATE TABLE IF NOT EXISTS public.transaction_types (
                            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                            name TEXT UNIQUE NOT NULL,
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
                        );`
                    },
                    {
                        name: 'properties',
                        query: `CREATE TABLE IF NOT EXISTS public.properties (
                            id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                            manager_id TEXT,
                            property_type TEXT,
                            transaction_type TEXT,
                            property_status TEXT,
                            location TEXT,
                            property_name TEXT,
                            floor_info TEXT,
                            rooms_bathrooms TEXT,
                            direction TEXT,
                            price NUMERIC,
                            sale_price NUMERIC,
                            lease_deposit NUMERIC,
                            monthly_rent NUMERIC,
                            maintenance_fee TEXT,
                            supply_area_sqm NUMERIC,
                            private_area_sqm NUMERIC,
                            supply_area_pyeong NUMERIC,
                            private_area_pyeong NUMERIC,
                            special_notes TEXT,
                            created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT now()
                        );`
                    }
                ];
                
                let successCount = 0;
                let errorCount = 0;
                
                for (const table of tables) {
                    try {
                        log(`ğŸ”„ ${table.name} í…Œì´ë¸” ìƒì„± ì¤‘...`);
                        const { error } = await supabase.rpc('execute_sql', {
                            sql: table.query
                        });
                        
                        if (error) {
                            log(`âŒ ${table.name} í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                            errorCount++;
                        } else {
                            log(`âœ… ${table.name} í…Œì´ë¸” ìƒì„± ì„±ê³µ`, 'success');
                            successCount++;
                        }
                    } catch (err) {
                        log(`âŒ ${table.name} í…Œì´ë¸” ìƒì„± ì¤‘ ì˜¤ë¥˜: ${err.message}`, 'error');
                        errorCount++;
                    }
                }
                
                // ê²°ê³¼ í‘œì‹œ
                if (errorCount === 0) {
                    updateResult('createTablesResult', `âœ… ëª¨ë“  í…Œì´ë¸” ìƒì„± ì™„ë£Œ (${successCount}ê°œ)`, 'success');
                    updateStatus('í…Œì´ë¸” ìƒì„± ì™„ë£Œ', 'success');
                } else {
                    updateResult('createTablesResult', `âš ï¸ ì¼ë¶€ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨ (ì„±ê³µ: ${successCount}, ì‹¤íŒ¨: ${errorCount})`, 'warning');
                    updateStatus('ì¼ë¶€ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨', 'warning');
                }
                
            } catch (error) {
                log(`âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                updateResult('createTablesResult', `âŒ í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('í…Œì´ë¸” ìƒì„± ì‹¤íŒ¨', 'error');
            } finally {
                createTablesBtn.disabled = false;
            }
        }
        
        async function setupInitialData() {
            const setupInitialDataBtn = document.getElementById('setupInitialDataBtn');
            setupInitialDataBtn.disabled = true;
            
            try {
                log('ğŸ”„ ì´ˆê¸° ë°ì´í„° ì„¤ì • ì‹œì‘...');
                updateResult('setupInitialDataResult', 'ì´ˆê¸° ë°ì´í„° ì„¤ì • ì¤‘...', 'info');
                
                // ë§¤ë¬¼ ì¢…ë¥˜ ì´ˆê¸° ë°ì´í„°
                const propertyTypes = [
                    { name: 'ì•„íŒŒíŠ¸' },
                    { name: 'ì£¼ìƒë³µí•©' },
                    { name: 'ë¹Œë¼/ì—°ë¦½' },
                    { name: 'ì˜¤í”¼ìŠ¤í…”' },
                    { name: 'ë‹¨ë…ì£¼íƒ' },
                    { name: 'ìƒê°€' },
                    { name: 'ì‚¬ë¬´ì‹¤' },
                    { name: 'ë¹Œë”©' },
                    { name: 'ì¬ê°œë°œ' },
                    { name: 'ë¶„ì–‘ê¶Œ' },
                    { name: 'ê¸°íƒ€' }
                ];
                
                // ê±°ë˜ ìœ í˜• ì´ˆê¸° ë°ì´í„°
                const transactionTypes = [
                    { name: 'ë§¤ë§¤' },
                    { name: 'ì „ì„¸' },
                    { name: 'ì›”ì„¸' },
                    { name: 'ë‹¨ê¸°ì„ëŒ€' },
                    { name: 'ë¶„ì–‘' }
                ];
                
                // ë§¤ë¬¼ ìƒíƒœ ì´ˆê¸° ë°ì´í„°
                const propertyStatuses = [
                    { name: 'ê±°ë˜ê°€ëŠ¥' },
                    { name: 'ê±°ë˜ì™„ë£Œ' },
                    { name: 'ê±°ë˜ë³´ë¥˜' },
                    { name: 'ê³„ì•½ì§„í–‰ì¤‘' }
                ];
                
                // ë°ì´í„° ì‚½ì… í•¨ìˆ˜
                async function insertData(tableName, data) {
                    try {
                        log(`ğŸ”„ ${tableName} ë°ì´í„° ì‚½ì… ì¤‘... (${data.length}ê°œ)`);
                        const { error } = await supabase.from(tableName).upsert(
                            data.map(item => ({
                                ...item,
                                created_at: new Date(),
                                updated_at: new Date()
                            })),
                            { onConflict: 'name' }
                        );
                        
                        if (error) {
                            log(`âŒ ${tableName} ë°ì´í„° ì‚½ì… ì‹¤íŒ¨: ${error.message}`, 'error');
                            return false;
                        } else {
                            log(`âœ… ${tableName} ë°ì´í„° ì‚½ì… ì„±ê³µ (${data.length}ê°œ)`, 'success');
                            return true;
                        }
                    } catch (err) {
                        log(`âŒ ${tableName} ë°ì´í„° ì‚½ì… ì¤‘ ì˜¤ë¥˜: ${err.message}`, 'error');
                        return false;
                    }
                }
                
                // ë°ì´í„° ì‚½ì… ì‹¤í–‰
                const results = [
                    await insertData('property_types', propertyTypes),
                    await insertData('transaction_types', transactionTypes),
                    await insertData('property_statuses', propertyStatuses)
                ];
                
                // ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„±
                try {
                    log('ğŸ”„ ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„± ì¤‘...');
                    const { error } = await supabase.from('users').upsert([
                        {
                            id: '00000000-0000-0000-0000-000000000000',
                            email: 'admin@the-realty.co.kr',
                            name: 'ê´€ë¦¬ì',
                            role: 'admin',
                            status: 'active',
                            created_at: new Date(),
                            updated_at: new Date()
                        }
                    ], { onConflict: 'id' });
                    
                    if (error) {
                        log(`âŒ ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                    } else {
                        log('âœ… ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„± ì„±ê³µ', 'success');
                        results.push(true);
                    }
                } catch (err) {
                    log(`âŒ ê´€ë¦¬ì ì‚¬ìš©ì ìƒì„± ì¤‘ ì˜¤ë¥˜: ${err.message}`, 'error');
                    results.push(false);
                }
                
                // ê²°ê³¼ í‘œì‹œ
                const successCount = results.filter(r => r).length;
                if (successCount === results.length) {
                    updateResult('setupInitialDataResult', 'âœ… ëª¨ë“  ì´ˆê¸° ë°ì´í„° ì„¤ì • ì™„ë£Œ', 'success');
                    updateStatus('ì´ˆê¸° ë°ì´í„° ì„¤ì • ì™„ë£Œ', 'success');
                } else {
                    updateResult('setupInitialDataResult', `âš ï¸ ì¼ë¶€ ì´ˆê¸° ë°ì´í„° ì„¤ì • ì‹¤íŒ¨ (ì„±ê³µ: ${successCount}, ì‹¤íŒ¨: ${results.length - successCount})`, 'warning');
                    updateStatus('ì¼ë¶€ ì´ˆê¸° ë°ì´í„° ì„¤ì • ì‹¤íŒ¨', 'warning');
                }
                
            } catch (error) {
                log(`âŒ ì´ˆê¸° ë°ì´í„° ì„¤ì • ì‹¤íŒ¨: ${error.message}`, 'error');
                updateResult('setupInitialDataResult', `âŒ ì´ˆê¸° ë°ì´í„° ì„¤ì • ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì´ˆê¸° ë°ì´í„° ì„¤ì • ì‹¤íŒ¨', 'error');
            } finally {
                setupInitialDataBtn.disabled = false;
            }
        }
        
        async function modifySchema() {
            const modifySchemaBtn = document.getElementById('modifySchemaBtn');
            modifySchemaBtn.disabled = true;
            
            try {
                log('ğŸ”„ ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì‹œì‘...');
                updateResult('modifySchemaResult', 'ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì¤‘...', 'info');
                
                // RLS ì •ì±… ì„¤ì •
                const { error: rlsError } = await supabase.rpc('execute_sql', {
                    sql: `
                        ALTER TABLE IF EXISTS public.properties DISABLE ROW LEVEL SECURITY;
                        ALTER TABLE IF EXISTS public.property_types DISABLE ROW LEVEL SECURITY;
                        ALTER TABLE IF EXISTS public.property_statuses DISABLE ROW LEVEL SECURITY;
                        ALTER TABLE IF EXISTS public.transaction_types DISABLE ROW LEVEL SECURITY;
                        ALTER TABLE IF EXISTS public.users DISABLE ROW LEVEL SECURITY;
                    `
                });
                
                if (rlsError) {
                    log(`âš ï¸ RLS ì •ì±… ìˆ˜ì • ì‹¤íŒ¨ (ê³„ì† ì§„í–‰): ${rlsError.message}`, 'warning');
                } else {
                    log('âœ… RLS ì •ì±… ìˆ˜ì • ì„±ê³µ', 'success');
                }
                
                // ìµëª… ì‚¬ìš©ì ê¶Œí•œ ë¶€ì—¬
                const { error: grantError } = await supabase.rpc('execute_sql', {
                    sql: `
                        GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO anon;
                        GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO authenticated;
                        GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO anon;
                        GRANT USAGE ON ALL SEQUENCES IN SCHEMA public TO authenticated;
                    `
                });
                
                if (grantError) {
                    log(`âš ï¸ ê¶Œí•œ ë¶€ì—¬ ì‹¤íŒ¨ (ê³„ì† ì§„í–‰): ${grantError.message}`, 'warning');
                } else {
                    log('âœ… ê¶Œí•œ ë¶€ì—¬ ì„±ê³µ', 'success');
                }
                
                updateResult('modifySchemaResult', 'âœ… ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì™„ë£Œ', 'success');
                updateStatus('ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì™„ë£Œ', 'success');
                
            } catch (error) {
                log(`âŒ ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì‹¤íŒ¨: ${error.message}`, 'error');
                updateResult('modifySchemaResult', `âŒ ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì‹¤íŒ¨', 'error');
            } finally {
                modifySchemaBtn.disabled = false;
            }
        }
        
        async function testConnection() {
            const testConnectionBtn = document.getElementById('testConnectionBtn');
            testConnectionBtn.disabled = true;
            
            try {
                log('ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                updateResult('testConnectionResult', 'í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
                
                // í…Œì´ë¸” ì¡´ì¬ í™•ì¸
                const tables = ['properties', 'property_types', 'property_statuses', 'transaction_types', 'users'];
                const tableResults = [];
                
                for (const table of tables) {
                    const { data, error, count } = await supabase
                        .from(table)
                        .select('*', { count: 'exact' })
                        .limit(1);
                        
                    if (error) {
                        tableResults.push(`âŒ ${table}: ${error.message}`);
                    } else {
                        tableResults.push(`âœ… ${table}: ${count || 0}ê°œ ë ˆì½”ë“œ`);
                    }
                }
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
                const testProperty = {
                    property_name: `í…ŒìŠ¤íŠ¸ ë§¤ë¬¼ ${Date.now()}`,
                    location: 'ì„œìš¸ì‹œ í…ŒìŠ¤íŠ¸êµ¬ í…ŒìŠ¤íŠ¸ë™',
                    property_type: 'ì•„íŒŒíŠ¸',
                    transaction_type: 'ë§¤ë§¤',
                    property_status: 'ê±°ë˜ê°€ëŠ¥',
                    sale_price: 500000000,
                    lease_deposit: 0,
                    monthly_rent: 0,
                    manager_id: 'admin'
                };
                
                const { data: insertData, error: insertError } = await supabase
                    .from('properties')
                    .insert([testProperty])
                    .select();
                
                if (insertError) {
                    log(`âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì‹¤íŒ¨: ${insertError.message}`, 'error');
                    tableResults.push(`âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€: ${insertError.message}`);
                } else {
                    log(`âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì„±ê³µ (ID: ${insertData[0].id})`, 'success');
                    tableResults.push(`âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€: ì„±ê³µ (ID: ${insertData[0].id})`);
                }
                
                // ê²°ê³¼ í‘œì‹œ
                const hasErrors = tableResults.some(r => r.includes('âŒ'));
                updateResult('testConnectionResult', tableResults.join('<br>'), hasErrors ? 'warning' : 'success');
                updateStatus(hasErrors ? 'ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨' : 'ëª¨ë“  í…ŒìŠ¤íŠ¸ ì„±ê³µ', hasErrors ? 'warning' : 'success');
                
            } catch (error) {
                log(`âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateResult('testConnectionResult', `âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                updateStatus('ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', 'error');
            } finally {
                testConnectionBtn.disabled = false;
            }
        }
        
        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
        }
        
        // ì „ì—­ í•¨ìˆ˜ ì„¤ì •
        window.createTables = createTables;
        window.setupInitialData = setupInitialData;
        window.modifySchema = modifySchema;
        window.testConnection = testConnection;
        window.clearLog = clearLog;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            log('ğŸš€ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë„êµ¬ ì´ˆê¸°í™” ì™„ë£Œ');
            updateStatus('ğŸŸ¢ ì¤€ë¹„ ì™„ë£Œ - ì„¤ì •ì„ ì‹œì‘í•˜ì„¸ìš”', 'success');
        });
    </script>
</body>
</html>