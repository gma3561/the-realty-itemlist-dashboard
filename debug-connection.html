<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ì—°ê²° ë””ë²„ê¹…</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 1000px; margin: 0 auto; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border-left: 5px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left: 5px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left: 5px solid #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-left: 5px solid #ffc107; }
        button { padding: 12px 20px; margin: 8px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        button:hover { background: #0056b3; transform: translateY(-1px); }
        button:disabled { background: #6c757d; cursor: not-allowed; transform: none; }
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .test-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; }
        .test-card h4 { margin: 0 0 10px 0; color: #495057; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 15px 0; border: 1px solid #dee2e6; }
        .property-item { border: 1px solid #ddd; padding: 12px; margin: 8px 0; border-radius: 6px; background: #fefefe; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Supabase ì—°ê²° ë””ë²„ê¹… ë„êµ¬</h1>
        
        <div id="mainStatus" class="status info">
            <div class="spinner"></div>
            ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...
        </div>
        
        <div class="test-grid">
            <div class="test-card">
                <h4>ğŸ”— ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸</h4>
                <button onclick="testBasicConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                <div id="connectionResult"></div>
            </div>
            
            <div class="test-card">
                <h4>ğŸ—ƒï¸ í…Œì´ë¸” êµ¬ì¡° í™•ì¸</h4>
                <button onclick="checkTables()">í…Œì´ë¸” í™•ì¸</button>
                <div id="tablesResult"></div>
            </div>
            
            <div class="test-card">
                <h4>ğŸ“Š ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸</h4>
                <button onclick="testDataFetch()">ë°ì´í„° ì¡°íšŒ</button>
                <div id="dataResult"></div>
            </div>
            
            <div class="test-card">
                <h4>ğŸ’¾ ë°ì´í„° ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</h4>
                <button onclick="testDataUpload()">ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸</button>
                <div id="uploadResult"></div>
            </div>
        </div>
        
        <div>
            <h3>ğŸ“ ë¡œê·¸</h3>
            <div id="debugLog" class="log">ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...\n</div>
            <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2';

        const supabaseUrl = 'https://qwxghpwasmvottahchky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3eGdocHdhc212b3R0YWhjaGt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTI3NTksImV4cCI6MjA2ODQ4ODc1OX0.4a1Oc66k9mGmXLoHmrKyZiVeZISpyzgq1BERrb_-8n8';
        
        const supabase = createClient(supabaseUrl, supabaseKey, {
            auth: { persistSession: false },
            global: {
                headers: {
                    'Access-Control-Allow-Origin': '*',
                    'Access-Control-Allow-Headers': '*',
                }
            }
        });

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('debugLog');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ”';
            logElement.innerHTML += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`${prefix} ${message}`);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('mainStatus');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
        }

        function addResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}" style="margin-top: 10px; font-size: 12px;">${content}</div>`;
        }

        async function testBasicConnection() {
            try {
                log('ğŸ”„ ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                addResult('connectionResult', 'ì—°ê²° ì¤‘...', 'info');
                
                // 1. ping í…ŒìŠ¤íŠ¸
                const pingStart = Date.now();
                const { data, error } = await supabase
                    .from('properties')
                    .select('count')
                    .limit(1);
                
                const pingTime = Date.now() - pingStart;
                
                if (error) {
                    throw new Error(`ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
                }
                
                log(`âœ… ê¸°ë³¸ ì—°ê²° ì„±ê³µ! (ì‘ë‹µì‹œê°„: ${pingTime}ms)`, 'success');
                addResult('connectionResult', `âœ… ì—°ê²° ì„±ê³µ (${pingTime}ms)`, 'success');
                
                return true;
            } catch (error) {
                log(`âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                addResult('connectionResult', `âŒ ${error.message}`, 'error');
                return false;
            }
        }

        async function checkTables() {
            try {
                log('ğŸ”„ í…Œì´ë¸” êµ¬ì¡° í™•ì¸ ì¤‘...');
                addResult('tablesResult', 'í™•ì¸ ì¤‘...', 'info');
                
                const tables = ['properties', 'property_types', 'transaction_types', 'property_statuses'];
                const results = [];
                
                for (const table of tables) {
                    try {
                        const { data, error, count } = await supabase
                            .from(table)
                            .select('*', { count: 'exact' })
                            .limit(1);
                        
                        if (error) {
                            results.push(`âŒ ${table}: ${error.message}`);
                        } else {
                            results.push(`âœ… ${table}: ${count}ê°œ ë ˆì½”ë“œ`);
                        }
                    } catch (err) {
                        results.push(`âŒ ${table}: ${err.message}`);
                    }
                }
                
                log('í…Œì´ë¸” í™•ì¸ ì™„ë£Œ', 'success');
                addResult('tablesResult', results.join('<br>'), results.some(r => r.includes('âŒ')) ? 'warning' : 'success');
                
            } catch (error) {
                log(`âŒ í…Œì´ë¸” í™•ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
                addResult('tablesResult', `âŒ ${error.message}`, 'error');
            }
        }

        async function testDataFetch() {
            try {
                log('ğŸ”„ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                addResult('dataResult', 'ì¡°íšŒ ì¤‘...', 'info');
                
                const { data, error, count } = await supabase
                    .from('properties')
                    .select('*', { count: 'exact' })
                    .limit(5);
                
                if (error) throw error;
                
                let resultHtml = `ì´ ${count}ê°œ ë§¤ë¬¼ ë°œê²¬<br>`;
                
                if (data && data.length > 0) {
                    resultHtml += '<br><strong>ìƒ˜í”Œ ë°ì´í„°:</strong><br>';
                    data.forEach((prop, i) => {
                        resultHtml += `${i+1}. ${prop.property_name} (${prop.location})<br>`;
                    });
                } else {
                    resultHtml += 'âŒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤';
                }
                
                log(`âœ… ë°ì´í„° ì¡°íšŒ ì„±ê³µ: ${count}ê°œ ë§¤ë¬¼`, 'success');
                addResult('dataResult', resultHtml, 'success');
                
            } catch (error) {
                log(`âŒ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
                addResult('dataResult', `âŒ ${error.message}`, 'error');
            }
        }

        async function testDataUpload() {
            try {
                log('ğŸ”„ ë°ì´í„° ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                addResult('uploadResult', 'ì—…ë¡œë“œ ì¤‘...', 'info');
                
                // í…ŒìŠ¤íŠ¸ ë°ì´í„°
                const testProperty = {
                    property_name: `í…ŒìŠ¤íŠ¸ ë§¤ë¬¼ ${Date.now()}`,
                    location: 'ì„œìš¸ì‹œ í…ŒìŠ¤íŠ¸êµ¬ í…ŒìŠ¤íŠ¸ë™',
                    property_type: 'apt',
                    transaction_type: 'sale',
                    property_status: 'available',
                    price: 100000000,
                    lease_price: 0,
                    manager_id: 'admin'
                };
                
                const { data, error } = await supabase
                    .from('properties')
                    .insert([testProperty])
                    .select();
                
                if (error) throw error;
                
                log('âœ… ë°ì´í„° ì—…ë¡œë“œ ì„±ê³µ!', 'success');
                addResult('uploadResult', `âœ… í…ŒìŠ¤íŠ¸ ë§¤ë¬¼ ì—…ë¡œë“œ ì„±ê³µ<br>ID: ${data[0].id}`, 'success');
                
            } catch (error) {
                log(`âŒ ë°ì´í„° ì—…ë¡œë“œ ì‹¤íŒ¨: ${error.message}`, 'error');
                addResult('uploadResult', `âŒ ${error.message}`, 'error');
            }
        }

        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        // ì „ì—­ í•¨ìˆ˜ ì„¤ì •
        window.testBasicConnection = testBasicConnection;
        window.checkTables = checkTables;
        window.testDataFetch = testDataFetch;
        window.testDataUpload = testDataUpload;
        window.clearLog = clearLog;

        // ìë™ ì‹œì‘
        window.addEventListener('load', async () => {
            log('ğŸš€ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
            updateStatus('ğŸŸ¢ ì¤€ë¹„ ì™„ë£Œ - í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”', 'success');
            
            // 3ì´ˆ í›„ ìë™ ì—°ê²° í…ŒìŠ¤íŠ¸
            setTimeout(async () => {
                log('ğŸ”„ ìë™ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘...');
                await testBasicConnection();
            }, 2000);
        });
    </script>
</body>
</html>