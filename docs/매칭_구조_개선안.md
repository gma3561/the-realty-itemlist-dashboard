# 매칭 구조 개선안

## 1. 핵심 비즈니스 프로세스 이해

부동산 중개의 핵심은 **"고객의 니즈와 매물을 매칭"**하는 것입니다.

```
고객 문의 → 니즈 파악 → 매물 추천 → 현장 안내 → 협상 → 계약
```

## 2. 개선된 매칭 구조

### 2.1 핵심 엔티티
```
1. 고객 (customers)
2. 매물 (properties) 
3. 담당자 (users)
4. 매칭 (property_matches)
```

### 2.2 주요 관계

#### A. 고객-매물 매칭 (property_matches)
```sql
CREATE TABLE property_matches (
  id UUID PRIMARY KEY,
  customer_id UUID REFERENCES customers(id),
  property_id UUID REFERENCES properties(id),
  matched_by UUID REFERENCES users(id), -- 매칭한 담당자
  match_type TEXT, -- 'recommendation', 'inquiry', 'viewing', 'negotiation', 'contract'
  match_status TEXT, -- 'active', 'cancelled', 'completed'
  match_score INTEGER, -- 매칭 적합도 (0-100)
  notes TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

#### B. 매칭 이력 추적 (match_activities)
```sql
CREATE TABLE match_activities (
  id UUID PRIMARY KEY,
  match_id UUID REFERENCES property_matches(id),
  activity_type TEXT, -- 'viewed', 'contacted', 'visited', 'negotiated', 'contracted'
  activity_date TIMESTAMP,
  notes TEXT,
  created_by UUID REFERENCES users(id)
);
```

### 2.3 단순화된 관계
- **담당자-매물**: properties.manager_id (1:N)
- **고객-담당자**: customers.assigned_to (1:N)
- **고객-매물**: property_matches (N:M with metadata)
- **소유주-매물**: properties.owner_id (1:N)

## 3. 비즈니스 로직 개선

### 3.1 고객 니즈 매칭
```javascript
// 고객 선호도 기반 매물 추천
async function recommendProperties(customerId) {
  const customer = await getCustomer(customerId);
  const { budget, preferred_area, property_type, transaction_type } = customer;
  
  // 매칭 점수 계산
  const properties = await findProperties({
    price_range: calculatePriceRange(budget),
    area: preferred_area,
    type: property_type,
    transaction: transaction_type
  });
  
  // 자동 매칭 생성
  return properties.map(property => ({
    customer_id: customerId,
    property_id: property.id,
    match_score: calculateMatchScore(customer, property),
    match_type: 'recommendation'
  }));
}
```

### 3.2 성과 추적
```javascript
// 담당자별 성과 지표
async function getPerformanceMetrics(userId) {
  return {
    total_customers: await countCustomers(userId),
    active_matches: await countActiveMatches(userId),
    completed_deals: await countCompletedDeals(userId),
    conversion_rate: await calculateConversionRate(userId),
    average_deal_time: await calculateAverageDealTime(userId)
  };
}
```

## 4. UI/UX 개선사항

### 4.1 고객 중심 대시보드
- 고객별 추천 매물 목록
- 고객 활동 타임라인
- 매칭 성공률 표시

### 4.2 매물 상세 페이지
- 관심 고객 목록
- 매칭 히스토리
- 유사 매물 추천

### 4.3 성과 대시보드
- 담당자별 매칭 성공률
- 고객 만족도
- 평균 거래 소요 시간

## 5. 데이터 활용 개선

### 5.1 매칭 알고리즘
```javascript
function calculateMatchScore(customer, property) {
  let score = 0;
  
  // 예산 적합도 (40%)
  if (property.price <= customer.max_budget) {
    score += 40 * (1 - (property.price - customer.min_budget) / (customer.max_budget - customer.min_budget));
  }
  
  // 지역 일치도 (30%)
  if (property.area === customer.preferred_area) {
    score += 30;
  }
  
  // 매물 유형 일치도 (20%)
  if (property.type === customer.preferred_type) {
    score += 20;
  }
  
  // 기타 선호사항 (10%)
  // 층수, 방향, 주차 등
  
  return Math.round(score);
}
```

### 5.2 고객 행동 분석
- 조회 패턴 분석
- 선호도 변화 추적
- 이탈 위험도 예측

## 6. 구현 우선순위

### Phase 1 (필수)
1. property_matches 테이블 생성
2. 고객-매물 매칭 CRUD
3. 기본 매칭 UI

### Phase 2 (중요)
1. 매칭 점수 알고리즘
2. 자동 추천 시스템
3. 성과 대시보드

### Phase 3 (개선)
1. 고급 분석 기능
2. AI 기반 매칭
3. 고객 행동 예측

## 7. 기대 효과

1. **업무 효율성**: 고객 니즈에 맞는 매물을 빠르게 찾을 수 있음
2. **성과 향상**: 매칭 성공률 증가로 거래 성사율 향상
3. **고객 만족도**: 맞춤형 추천으로 고객 만족도 증가
4. **데이터 기반 의사결정**: 객관적인 성과 지표로 전략 수립

## 8. 마이그레이션 전략

### 8.1 기존 데이터 활용
- CSV의 "거주자" → 임차인 고객으로 변환
- "임차유형", "임차금액" → 고객 선호도 데이터로 활용
- 거래완료 매물 → 과거 매칭 성공 사례로 분석

### 8.2 단계적 전환
1. 신규 고객부터 새 구조 적용
2. 기존 데이터 점진적 마이그레이션
3. 담당자 교육 및 적응 기간 제공