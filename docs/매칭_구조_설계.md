# 팀 매물장 매칭 구조 설계

## 1. 매칭 구조 개요

매칭 구조란 매물과 관련된 다양한 이해관계자(담당자, 소유주, 공동중개사, 고객 등) 간의 관계를 효율적으로 관리하기 위한 시스템입니다. 이 문서는 일주일 내에 개발을 완료하기 위한 핵심적인 매칭 구조를 정의합니다.

## 2. 핵심 매칭 관계

### 2.1 담당자-매물 매칭
- **1:N 관계**: 한 담당자는 여러 매물을 관리할 수 있음
- **책임**: 매물 등록, 정보 업데이트, 광고 관리, 고객 응대
- **기능**: 담당자별 매물 필터링, 담당자 변경 이력 추적

### 2.2 공동중개-매물 매칭
- **N:1 관계**: 한 매물에 여러 공동중개사가 참여할 수 있음
- **책임**: 매물 공동 관리, 정보 공유, 수수료 분배
- **기능**: 공동중개사 추가/제거, 연락처 관리

### 2.3 소유주-매물 매칭
- **1:N 관계**: 한 소유주는 여러 매물을 소유할 수 있음
- **정보**: 소유주 정보(이름, 연락처, 주민등록번호 등) 관리
- **기능**: 소유주별 매물 그룹화, 소유주 연락처 변경 추적

## 3. 데이터베이스 스키마 최적화

### 3.1 중복 데이터 최소화
기존 설계에서 매물 테이블에 담당자, 공동중개사, 소유주 정보가 모두 포함되어 있었습니다. 효율적인 개발을 위해 다음과 같이 정규화합니다:

#### properties (매물)
- id: uuid (PK)
- manager_id: uuid (FK -> users.id)
- owner_id: uuid (FK -> owners.id) 
- property_name: text
- location: text
- 기타 매물 정보...

#### co_brokers (공동중개)
- id: uuid (PK)
- property_id: uuid (FK -> properties.id)
- broker_name: text
- broker_contact: text
- share_percentage: numeric
- created_at: timestamp

#### owners (소유주)
- id: uuid (PK)
- name: text
- id_number: text
- phone: text
- contact_relation: text
- created_at: timestamp
- updated_at: timestamp

### 3.2 매칭 관계 쿼리 최적화
- **인덱스 설정**: manager_id, owner_id에 인덱스 설정
- **자주 사용하는 조인 쿼리 최적화**: 담당자별 매물 조회, 소유주별 매물 조회
- **Supabase RLS 정책**: 담당자는 자신의 매물만 수정 가능하도록 설정

## 4. 프론트엔드 구현 전략

### 4.1 매칭 관리 컴포넌트
```
src/components/matching/
├── ManagerAssignment.jsx       # 담당자 배정/변경
├── CoBrokerManagement.jsx      # 공동중개사 관리
├── OwnerAssignment.jsx         # 소유주 연결
└── MatchingHistory.jsx         # 매칭 변경 이력
```

### 4.2 관계 시각화
- **담당자-매물 관계**: 대시보드에 담당자별 매물 수 차트
- **공동중개 현황**: 매물 상세 페이지에 공동중개사 목록
- **소유주 매물**: 소유주 상세 페이지에 소유 매물 목록

## 5. 빠른 개발을 위한 매칭 구현 우선순위

### 5.1 1일차: 기본 구조 구현
- 데이터베이스 스키마 설정
- 기본 CRUD API 엔드포인트 구현

### 5.2 2-3일차: 핵심 매칭 기능 구현
- 담당자-매물 매칭 기능
- 소유주-매물 매칭 기능
- 매칭 관리 UI 구현

### 5.3 4-5일차: 고급 매칭 기능 구현
- 공동중개 관리 기능
- 매칭 변경 이력 추적
- 권한 기반 매칭 관리

### 5.4 6-7일차: 최적화 및 테스트
- 성능 최적화
- 사용자 테스트
- 버그 수정

## 6. 매칭 API 엔드포인트

### 6.1 담당자-매물 매칭
- `GET /properties/by-manager/:managerId`: 담당자별 매물 조회
- `PUT /properties/:id/assign-manager`: 담당자 변경
- `GET /managers/by-property/:propertyId`: 매물의 담당자 이력 조회

### 6.2 공동중개 관리
- `POST /properties/:id/co-brokers`: 공동중개사 추가
- `DELETE /properties/:id/co-brokers/:brokerId`: 공동중개사 제거
- `GET /properties/:id/co-brokers`: 매물의 공동중개사 조회

### 6.3 소유주 관리
- `GET /owners`: 소유주 목록 조회
- `POST /owners`: 소유주 등록
- `GET /owners/:id/properties`: 소유주의 매물 조회

## 7. 확장성 고려사항

초기 개발에서는 일주일 내 구현에 집중하지만, 향후 확장을 위한 고려사항도 염두에 둡니다:

- **매칭 이력 관리**: 담당자, 공동중개사 변경 이력을 보관하여 추적성 확보
- **자동 매칭 추천**: 담당자의 전문 분야, 실적 등을 고려한 자동 매칭 추천
- **매칭 효율성 분석**: 담당자-매물 매칭의 성과를 분석하여 최적 매칭 도출

## 8. 매칭 구조 일정 계획

| 일자 | 주요 작업 | 세부 작업 |
|------|----------|----------|
| 1일차 | 데이터베이스 설계 | 매물, 담당자, 소유주, 공동중개 테이블 설계 및 관계 정의 |
| 2일차 | 기본 API 구현 | 담당자-매물, 소유주-매물 매칭 API 구현 |
| 3일차 | 매칭 UI 컴포넌트 | 담당자 배정, 소유주 연결 UI 구현 |
| 4일차 | 공동중개 기능 | 공동중개사 관리 기능 및 UI 구현 |
| 5일차 | 매칭 관리 화면 | 매칭 관리 대시보드 및 필터링 구현 |
| 6일차 | 테스트 및 최적화 | 기능 테스트, 성능 최적화 |
| 7일차 | 버그 수정 및 배포 | 최종 테스트, 버그 수정, 배포 준비 |

이 매칭 구조를 통해 매물과 관련된 다양한 관계를 효율적으로 관리할 수 있으며, 일주일 내에 개발을 완료할 수 있는 핵심 기능에 집중할 수 있습니다.